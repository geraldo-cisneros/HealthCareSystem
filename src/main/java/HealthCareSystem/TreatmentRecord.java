/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package HealthCareSystem;
import static HealthCareSystem.CancelAppointment.getAppointment;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Scanner;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;

/**
 *
 * @author geraldocisneros
 */
public class TreatmentRecord extends javax.swing.JFrame {

    /**
     * Creates new form TreatmentRecord
     */
    public TreatmentRecord() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        pFName = new javax.swing.JLabel();
        pLName = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        Treatment = new javax.swing.JTextArea();
        jScrollPane2 = new javax.swing.JScrollPane();
        Prescriptions = new javax.swing.JTextArea();
        saveButton = new javax.swing.JButton();
        closeButton = new javax.swing.JButton();
        jScrollPane3 = new javax.swing.JScrollPane();
        ReasonForVisit = new javax.swing.JTextArea();
        BirthDate = new javax.swing.JLabel();
        Height = new javax.swing.JTextField();
        Weight = new javax.swing.JTextField();
        BloodPressure = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jLabel1.setText("Treatment Record");

        pFName.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "First Name", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));

        pLName.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Last Name", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));

        Treatment.setColumns(20);
        Treatment.setRows(5);
        Treatment.setText("\n");
        Treatment.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Treatment", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));
        jScrollPane1.setViewportView(Treatment);

        Prescriptions.setColumns(20);
        Prescriptions.setRows(5);
        Prescriptions.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Prescriptions", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));
        jScrollPane2.setViewportView(Prescriptions);

        saveButton.setText("Save");
        saveButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveButtonActionPerformed(evt);
            }
        });

        closeButton.setText("Close");
        closeButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeButtonActionPerformed(evt);
            }
        });

        ReasonForVisit.setColumns(20);
        ReasonForVisit.setRows(5);
        ReasonForVisit.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Reason For Visit", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));
        jScrollPane3.setViewportView(ReasonForVisit);

        BirthDate.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Birth Date", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));

        Height.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Height", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));

        Weight.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Weight", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));

        BloodPressure.setActionCommand("<Not Set>");
        BloodPressure.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "Blood Pressure", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));
        BloodPressure.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BloodPressureActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(72, 72, 72)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(pFName, javax.swing.GroupLayout.DEFAULT_SIZE, 153, Short.MAX_VALUE)
                            .addComponent(Height))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(pLName, javax.swing.GroupLayout.DEFAULT_SIZE, 153, Short.MAX_VALUE)
                            .addComponent(Weight))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(BirthDate, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(BloodPressure, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(jScrollPane2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 495, Short.MAX_VALUE)
                            .addComponent(jScrollPane1)
                            .addComponent(jScrollPane3, javax.swing.GroupLayout.Alignment.LEADING))
                        .addContainerGap(77, Short.MAX_VALUE))))
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(220, 220, 220)
                        .addComponent(closeButton)
                        .addGap(53, 53, 53)
                        .addComponent(saveButton))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(265, 265, 265)
                        .addComponent(jLabel1)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap(40, Short.MAX_VALUE)
                .addComponent(jLabel1)
                .addGap(33, 33, 33)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(pFName, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(pLName, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(BirthDate, javax.swing.GroupLayout.DEFAULT_SIZE, 42, Short.MAX_VALUE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(Height, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(Weight, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(BloodPressure, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 106, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(saveButton)
                    .addComponent(closeButton))
                .addGap(29, 29, 29))
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void saveButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveButtonActionPerformed
        // TODO add your handling code here:
        String first = pFName.getText();
        String last = pLName.getText();
        String bday = BirthDate.getText();
        String ht = Height.getText();
        String wt = Weight.getText();
        String bp = BloodPressure.getText();
        String reason = ReasonForVisit.getText();
        String treatment = Treatment.getText();
        String rx = Prescriptions.getText();
        String flbday = first + " " + last + " " + bday;
        String newData = "###\n" + first + " " + last + " " + bday + "\n" +
                         "Height = " + ht + "\nWeight = " + wt + "\nBlood Pressure = " + bp +
                         "\nReason = " + reason + "\nTreatment = " + treatment + "\nRx = " + rx +"\n###\n" ;
        
                
        String recordfile = "src/main/java/HealthCareSystem/treatmentRecords.txt";
        String output = "src/main/java/HealthCareSystem/output.txt";
        String tempfile = "src/main/java/HealthCareSystem/temp.txt";
        
        String type = "Treatment Record";
        Boolean found = recordExists(flbday, recordfile);
        if (found){
            String oldData = getTreatmentRecord(first + " " + last + " " + bday);
            ViewPatientChart.storeWriteData(oldData, tempfile, false);
            try {
                CancelAppointment.updateDataFile(output, recordfile, tempfile);
            } catch (IOException ex) {
                Logger.getLogger(TreatmentRecord.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
        NewAppointment.writeToFile(recordfile, newData, type, true);
    }//GEN-LAST:event_saveButtonActionPerformed

    private void closeButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeButtonActionPerformed
        // TODO add your handling code here:
        this.dispose();
    }//GEN-LAST:event_closeButtonActionPerformed

    private void BloodPressureActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BloodPressureActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_BloodPressureActionPerformed
    
    public static void findTreatmentRecord(String n){
        TreatmentRecord tr = new TreatmentRecord();
        Map<String, String> treatmentMap = new LinkedHashMap<String, String>();
        String f = " ",l = " ",bday = " ",h = " ",w = " ",bp = " ",reason = " ",treatment = " ",rx = " ";
        String line = " ", idString;
        idString = getEmpID();
        Character c = idString.charAt(1);
        Integer id = Character.getNumericValue(c);
        System.out.println(id);
        Boolean found = false;
        try{
            File charts = new File("src/main/java/HealthCareSystem/treatmentRecords.txt");
            Scanner scanner = new Scanner(charts);
            while (scanner.hasNextLine()) {
                line = scanner.nextLine();
                if(line.equals(n)){
                    System.out.println(line);
                    found = true; 
                    f = line.split(" ")[0];
                    l = line.split(" ")[1];
                    bday = line.split(" ")[2];
                    h = scanner.nextLine().split(" =")[1];
                    w = scanner.nextLine().split(" =")[1];
                    bp = scanner.nextLine().split(" =")[1];
                    reason = scanner.nextLine().split(" =")[1];
                    treatment = scanner.nextLine().split(" =")[1];
                    rx = scanner.nextLine().split(" =")[1];
                }
            }
            if (found){
                if (id == 2){
                      UpdateMeasurements um = new UpdateMeasurements();
                      String vars = f + " " + l + " " + bday + " " + h + " " + w + " " + bp;
                      System.out.println(vars);
                      UpdateMeasurements.setMeasurements(vars, reason, treatment, rx);
                    }
                else{
                    tr.setVisible(true);
                    tr.pFName.setText(f);
                    tr.pLName.setText(l);
                    tr.BirthDate.setText(bday);
                    tr.Height.setText(h);
                    tr.Weight.setText(w);
                    tr.BloodPressure.setText(bp);
                    tr.ReasonForVisit.setText(reason);
                    tr.Treatment.setText(treatment);
                    tr.Prescriptions.setText(rx);
                }
            }
            if (!found){
                    Integer selection = JOptionPane.showConfirmDialog(null, "Patient treatment record not found, would you like to create a new one?");
                    if(selection == 0){
                        tr.setVisible(true);
                        tr.pFName.setText(n.split(" ")[0]);
                        tr.pLName.setText(n.split(" ")[1]);
                        tr.BirthDate.setText(n.split(" ")[2]);
                    }
                }
        }catch (FileNotFoundException e) {
            System.out.println("An error occurred.");
            e.printStackTrace();
        }
    }
    public static Boolean recordExists(String n, String searchFile){
        Boolean found = false;
        String line;
        try{
            File charts = new File(searchFile);
            Scanner scanner = new Scanner(charts);
            while (scanner.hasNextLine()) {
                line = scanner.nextLine();
                if(line.contains(n) || line.equals(n)){
                    found = true;            
                }
            }
        }catch (FileNotFoundException e) {
            System.out.println("An error occurred.");
            e.printStackTrace();
        }
        return found;
    }
    public static String getTreatmentRecord(String n){
        TreatmentRecord tr = new TreatmentRecord();
        Map<String, String> treatmentMap = new LinkedHashMap<String, String>();
        String line;
        String firstlastbday = " ", ht= " ", wt= " ",bp = " ",  
               reason= " ", treatment = " ", rx = " ", record = " ";
        Boolean found = false;
        try{
            File charts = new File("src/main/java/HealthCareSystem/treatmentRecords.txt");
            Scanner scanner = new Scanner(charts);
            while (scanner.hasNextLine()) {
                line = scanner.nextLine();
                if(line.equals(n)){
                    found = true;
                    
                    firstlastbday = line;
                    ht = scanner.nextLine();
                    wt = scanner.nextLine();
                    bp = scanner.nextLine();
                    reason = scanner.nextLine();
                    treatment = scanner.nextLine();
                    rx = scanner.nextLine();
                    
                }
            }
            if (!found){
                    JOptionPane.showMessageDialog(null, "Patient treatment record not found");
            }
            record = "###\n" + firstlastbday + "\n" +
                            ht + "\n" + wt + "\n" + bp + "\n" + reason + 
                            "\n" + treatment + "\n" + rx + "\n###\n";
            
        }catch (FileNotFoundException e) {
            System.out.println("An error occurred.");
            e.printStackTrace();
        }
        System.out.println("record = " + record);
        return record; 
    }
    public static String getEmpID(){
        String line = " ", id = " ";
        try{
            File charts = new File("src/main/java/HealthCareSystem/loggedIn.txt");
            Scanner scanner = new Scanner(charts);
            while (scanner.hasNextLine()) {
                line = scanner.nextLine();
            }
            id = line;
        }catch (FileNotFoundException e) {
            System.out.println("An error occurred.");
            e.printStackTrace();
        }       
        return id;
    }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(TreatmentRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(TreatmentRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(TreatmentRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(TreatmentRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new TreatmentRecord().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel BirthDate;
    private javax.swing.JTextField BloodPressure;
    private javax.swing.JTextField Height;
    private javax.swing.JTextArea Prescriptions;
    private javax.swing.JTextArea ReasonForVisit;
    private javax.swing.JTextArea Treatment;
    private javax.swing.JTextField Weight;
    private javax.swing.JButton closeButton;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JLabel pFName;
    private javax.swing.JLabel pLName;
    private javax.swing.JButton saveButton;
    // End of variables declaration//GEN-END:variables
}
